kke_lab_linux-iptables
We have one of our websites up and running on our Nautilus infrastructure in Stratos DC. Our security team has raised a concern that right now Apacheâ€™s port i.e 8082 is open for all since there is no firewall installed on these hosts. So we have decided to add some security layer for these hosts and after discussions and recommendations we have come up with the following requirements:


Install iptables and all its dependencies on each app host.

Block incoming port 8082 on all apps for everyone except for LBR host.

Make sure the rules remain, even after system reboot.


iptables -I INPUT -p tcp ! -s 172.16.238.14 --dport 8082 -j DROP

[root@stapp03 banner]# iptables -I INPUT -p tcp ! -s 172.16.238.14 --dport 8082 -j DROP
[root@stapp03 banner]# iptables-save
# Generated by iptables-save v1.4.21 on Wed Mar 17 17:47:17 2021
*filter
:INPUT ACCEPT [33:2300]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [17:1584]
-A INPUT ! -s 172.16.238.14/32 -p tcp -m tcp --dport 8082 -j DROP
COMMIT
# Completed on Wed Mar 17 17:47:17 2021
# Generated by iptables-save v1.4.21 on Wed Mar 17 17:47:17 2021
*nat
:PREROUTING ACCEPT [23:1710]
:INPUT ACCEPT [5:236]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [4:305]
:DOCKER_OUTPUT - [0:0]
:DOCKER_POSTROUTING - [0:0]
-A OUTPUT -d 127.0.0.11/32 -j DOCKER_OUTPUT
-A POSTROUTING -d 127.0.0.11/32 -j DOCKER_POSTROUTING
-A DOCKER_OUTPUT -d 127.0.0.11/32 -p tcp -m tcp --dport 53 -j DNAT --to-destination 127.0.0.11:42539
-A DOCKER_OUTPUT -d 127.0.0.11/32 -p udp -m udp --dport 53 -j DNAT --to-destination 127.0.0.11:34159
-A DOCKER_POSTROUTING -s 127.0.0.11/32 -p tcp -m tcp --sport 42539 -j SNAT --to-source :53
-A DOCKER_POSTROUTING -s 127.0.0.11/32 -p udp -m udp --sport 34159 -j SNAT --to-source :53
COMMIT
# Completed on Wed Mar 17 17:47:17 2021
[root@stapp03 banner]#
